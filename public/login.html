<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>AllSet | Login</title>
    
    <link rel="website icon" type="png" href="./assets/img/logoAllSet.png" />
    <link rel="stylesheet" href="./css/login.css">
    <!-- <link rel="icon" href="./assets/logo_fundo_branco.png"> -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

  <body>
    <div class="principal2">

        <div class="camposLogin">

            <div class="headerLogin">

                <img src="./assets/streamlineAzul.png" alt="">

                <div class="home">
                    <a href="./index.html"><img src="./assets/iconevoltar.png" alt="">Voltar para Home</a>
                </div>

            </div>

            <div class="Login tamanho-login">
                <h1>Efetue o login</h1>
                <span>Caso possua um cadastro, insira seus dados abaixo:</span>
                <br>
                <input type="text" id="ipt_usuario" class="inputLogin" placeholder="Email"><br>
                <input type="password" id="ipt_senha" class="inputLogin" placeholder="Senha"><br>
                <button onclick="login()" id="button_login" class="button">Entrar</button>

            </div>

            <div class="footerLogin">

                <div class="sem_cadastro">
                    <p>Não possui cadastro?<a href="./cadastro-funcionario.html" style="color: #fff;">
                            <span style="color:#fff; text-decoration: underline;"> Clique aqui</span></a></p>
                </div>

            </div>

        </div>

        <div class="imagem">

        </div>
    </div>
</body>

</html>

<script>
   src="./login.js"
  function entrar() {
    var email = document.getElementById("email_input").value;
    var senha = document.getElementById("senha_input").value;

    if (email == "monitoramento@allset.com" && senha == "Mon123@") {
      window.location.href = "monitoramento_real.html";
    } else if (email == "adm@allser.com" && senha == "Adm123@") {
      window.location.href = "monitoramento_real.html";
    } else {
      div_erros_login.innerHTML =
        "Login inválido! Verifique se as informações foram escritas corretamente";
      console.log(email);
      console.log(senha);
    }

    function login() {
        var login = ipt_usuario.value
        var senha = ipt_senha_login.value

        // validações
        // Validação de autenticação (adicionar após a implementação da API de comunicação com BD)
        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                login: login,
                senha: senha
            })
        })

            .then((resposta) => {
                if (resposta.status == 200) {
                    resposta.json()
                        .then((resultado) => {
                            sessionStorage.setItem("idUsuario", resultado[0].idUsuario)
                            if (resultado[0].nivel == 2) {
                                window.location.href = "./suporte/suporte.html"
                            } else
                            // caso a empresa esteja com o cadastro ativo, vamos redirecionar para a dashboard, caso não
                            if (resultado[0].isAtivo == 1) {
                                // armazenando os dados do usuário logado no SessionStorage
                                sessionStorage.setItem("idEmpresa", resultado[0].fkEmpresa)
                                // verificando nível de usuário e o direcionando para a tela certa
                                window.location.href = "./dashboard/dashboard.html"
                            } else {
                                alert("Sua empresa não está com cadastro ativo ainda!")
                            }
                        })
                        .catch((erro) => {
                            // console.log(erro);
                        })
                } else if (resposta.status == 403) {
                    // usuario ou senha incorretos
                    modal_mensagem_erro.style.display = 'flex'
                    modal_erro.style.display = 'flex'
                } else {
                    console.error("Erro inesperado ao logar", resposta)
                }

            })
            .catch((erro) => {
                console.log(erro)
            })

    }
  }
</script>
