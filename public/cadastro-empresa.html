<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/login.css">
    <link rel="stylesheet" href="./css/mobile-login.css">
    <link rel="website icon" type="png" href="./assets/img/logoAllSet.png">
    <script src="./js/sessao.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.8/jquery.inputmask.min.js" ></script>
    <script src="https://kit.fontawesome.com/88fed8b646.js" crossorigin="anonymous"></script>
    <title>AllSet - Cadastro Empresa</title>
</head>

<body>
    <!-- <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
            <span id="mensagem_erro"></span>
        </div> -->
    <!-- </div> -->


   <a href="index.html" class="voltar"> <i class="fa-solid fa-arrow-left"></i></a>
   <h1 class="titulo-form">AllSet</h1>
   
    <div class="formulario">
      <span class="titulo">Cadastro - Empresa</span>
         <div id="cadastro1">
           <div class="campo">
             <span>Nome da Empresa:</span>
            <input id="nomeEmpresa_input" type="text" placeholder="AllSet">
          </div>
          
          <div class="campo">
            <span>CNPJ:</span>
            <small style="font-size: 15px;">Digite apenas números</small>
            <input id="cnpj_input" type="text" placeholder="00.000.000/0000-00">
          </div>
        </div>
        <div id="cadastro2">
          <div class="campo">
            <Span> Agora é necessário cadastrar uma unidade para a sua empresa.</Span>
            <span>Nome da Unidade:</span>
           <input id="unidade_input" type="text" placeholder="Unidade avenida paulista">
          </div>
          <div class="campo">
            <span>CEP:</span>
            <input id="cep_input" type="text" placeholder=" 00000-000" oninput="autoPreencherCep()">
          </div>      
         <div class="campo">
           <span>Estado:</span>
           <input id="estado_input" type="text" placeholder="São Paulo" disabled>
         </div>
         <div class="campo">
          <span>Cidade:</span>
          <input id="cidade_input" type="text" placeholder="São Paulo"disabled>
        </div>
        <div class="campo">
          <span>Bairro:</span>
          <input id="bairro_input" type="text" placeholder="Jardim paulista"disabled>
        </div>
        <div class="campo">
          <span>Logradouro:</span>
          <input id="logradouro_input" type="text" placeholder="Jardim paulista"disabled>
        </div>
        <div class="campo">
          <span>Complemento:</span>
          <input id="complemento_input" type="text" placeholder="Jardim paulista">
        </div>
        <div class="campo">
          <span>Contato celular:</span>
          <input id="contato_input" type="text" placeholder="11123456789">
        </div>
       </div>
       <div id="cadastro3">
        <div class="campo">
          <span>Por fim, vamos cadastrar um usuário administrativo.</span>
          <span>Nome:</span>
         <input id="username_input" type="text" placeholder="Usuario administrativo">
       </div>
       <div class="campo">
         <span>Senha:</span>
         <input id="password_input" type="text" placeholder="xxxxxxxxxxxx">
       </div>
       <div class="campo">
        <span>Email:</span>
        <input id="email_input" type="text" placeholder="emailteste@email.com">
      </div>
     </div>
        <div id="div_erros_login"></div>
        <button class="botao" onclick="cadastrar()">Continuar</button>
        <a href="./login.html" class="texto-link">Já possui uma conta? Faça login</a>
    </div>

    
    <div id="div_aguardar" class="loading-div">
        <img src="./assets/gifazul.gif" id="loading-gif" />
    </div>



</body>

</html>

<script>
  var etapa_cadastro = 0;

  let nomeEmpresa = document.getElementById('nomeEmpresa_input');
  let cnpj = document.getElementById('cnpj_input');
  let unidade = document.getElementById('unidade_input');
  let cep = document.getElementById('cep_input');
  let estado = document.getElementById('estado_input');
  let cidade = document.getElementById('cidade_input');
  let bairro = document.getElementById('bairro_input');
  let logradouro = document.getElementById('logradouro_input');
  let complemento = document.getElementById('complemento_input');
  let contato = document.getElementById('contato_input');
  let username = document.getElementById('username_input');
  let password = document.getElementById('password_input');
  let email = document.getElementById('email_input');

  let nomeEmpresaValido = false;
  let cnpjValido = false;
  let unidadeValido = false;
  let cepValido = false;
  let estadoValido = false;
  let cidadeValido = false;
  let bairroValido = false;
  let logradouroValido = false;
  let complementoValido = false;
  let contatoValido = false;
  let usernameValido = false;
  let passwordValido = false;
  let emailValido = false;

  function validar() {
    var minCharNomeEmpresa = false;
    var tamanhoNomeEmpresa = nomeEmpresa.value.length;
    if (tamanhoNomeEmpresa <= 6) {
      console.log(nomeEmpresa.value);
      console.log("\nNome da empresa muito curto");
    } else {
      minCharNomeEmpresa = true;
    }
    if (minCharNomeEmpresa) {
      nomeEmpresaValido = true;
    }

    Inputmask("99.999.999/9999-99").mask(cnpj);
    let cnpjsemEspaco = cnpj.value.replace(/\D/g, '');
    var tamanhoCnpj = cnpjsemEspaco.length;
    var minCharCnpj = false;
    if (tamanhoCnpj !== 14) {
      console.log(cnpjsemEspaco);
      console.log('\nCNPJ não tem 14 dígitos');
    } else {
      minCharCnpj = true;
    }
    if (minCharCnpj) {
      cnpjValido = true;
    }

    var minCharUnidade = false;
    var tamanhoUnidade = unidade.value.length;
    if (tamanhoUnidade <= 5) {
      console.log(unidade.value);
      console.log("\nUnidade muito curta");
    } else {
      minCharUnidade = true;
    }
    if (minCharUnidade) {
      unidadeValido = true;
    }

    Inputmask("(99) 99999-9999").mask(contato);
    let contatoLimpo = contato.value.replace(/\D/g, '');
    let minCharContato = false;
    let tamanhoContato = contatoLimpo.length;
    if (tamanhoContato !== 11) {
      console.log(contatoLimpo);
      console.log('\nContato não tem 11 dígitos');
    } else {
      minCharContato = true;
    }
    if (minCharContato) {
      contatoValido = true;
    }

    let minMaxCharUsername = false;
    let tamanhoUsername = username.value.length;
    if (tamanhoUsername < 5) {
      console.log(username.value);
      console.log('\nUsername muito curto');
    } else if (tamanhoUsername > 20) {
      console.log(username.value);
      console.log('\nUsername muito longo');
    } else {
      minMaxCharUsername = true;
    }
    let usernameSemEspaco = /^\S*$/.test(username.value);
    if (!usernameSemEspaco) {
      console.log(username.value);
      console.log('\nUsername possui espaço');
    }
    if (usernameSemEspaco && minMaxCharUsername) {
      usernameValido = true;
    }

    let minMaxCharPassword = false;
    let tamanhoPassword = password.value.length;
    if (tamanhoPassword < 8) {
      console.log(password.value);
      console.log('\nSenha muito curta');
    } else if (tamanhoPassword > 70) {
      console.log(password.value);
      console.log('\nSenha muito longa');
    } else {
      minMaxCharPassword = true;
    }
    let passwordTemMaiusculo = /[A-Z]/.test(password.value);
    let passwordTemMinusculo = /[a-z]/.test(password.value);
    if (!passwordTemMaiusculo) {
      console.log(password.value);
      console.log('\nSenha não tem maiúscula');
    }
    if (!passwordTemMinusculo) {
      console.log(password.value);
      console.log('\nSenha não tem minúscula');
    }
    let passwordTemCharEspecial = /[!@#$%^&*(),.?":{}|<>]/.test(password.value);
    if (!passwordTemCharEspecial) {
      console.log(password.value);
      console.log('\nSenha não tem caractere especial');
    }
    let passwordTemNumero = /\d/.test(password.value);
    if (!passwordTemNumero) {
      console.log(password.value);
      console.log('\nSenha não tem número');
    }
    if (minMaxCharPassword && passwordTemMaiusculo && passwordTemMinusculo && passwordTemNumero && passwordTemCharEspecial) {
      passwordValido = true;
    }

    let emailTemFormatoPadrao = /^.+@.+\.com$/.test(email.value);
    if (!emailTemFormatoPadrao) {
      console.log(email.value);
      console.log('\nEmail fora do padrão xxxx@xxx.com');
    } else {
      emailValido = true;
    }
  }

  function autoPreencherCep() {
    Inputmask("99.999-999").mask(cep);
    let cepLimpo = cep.value.replace(/\D/g, '');
    let tamanhoCEP = cepLimpo.length;
    let minCharCEP = false;
    let cepValido = false;
    if (tamanhoCEP !== 8) {
      console.log(cepLimpo);
      console.log('CEP sem 8 dígitos');
    } else {
      minCharCEP = true;
    }
    if (minCharCEP) {
      cepValido = true;
    }
    if (cepValido) {
      fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`)
        .then(response => response.json())
        .then(dados => {
          estado.value = dados.estado;
          logradouro.value = dados.logradouro;
          bairro.value = dados.bairro;
          cidade.value = dados.localidade;
        })
        .catch(error => {
          console.log('Erro ao buscar o CEP:', error);
        });
    }
  }

  let listaEmpresasCadastradas = [];

  function cadastrar() {
    if (etapa_cadastro == 0) {
      console.log(nomeEmpresa.value)
      console.log(cnpj.value)
      console.log("Armazenados dados empresa.");
        document.getElementById('cadastro1').style.display = 'none';
        document.getElementById('cadastro2').style.display = 'initial';
      
    } else if (etapa_cadastro == 1) {
      console.log("Armazenados dados unidade.");
      document.getElementById('cadastro2').style.display = 'none';
      document.getElementById('cadastro3').style.display = 'initial';
    } else {
      console.log("Armazenados dados funcionário.");
      console.log("Mandar dados para o banco");
      console.log(etapa_cadastro);
      window.location = "\monitoramento_real.html";
    }
    etapa_cadastro++;
  }

  function listar() {
    fetch("/empresas/listar", {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((empresas) => {
          empresas.forEach((empresa) => {
            listaEmpresasCadastradas.push(empresa);
            console.log("listaEmpresasCadastradas");
            console.log(listaEmpresasCadastradas[0].codigo_ativacao);
          });
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function sumirMensagem() {
    cardErro.style.display = "none";
  }
</script>
